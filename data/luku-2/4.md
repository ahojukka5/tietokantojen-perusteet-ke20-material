---
path: '/luku-2/4'
title: 'Kyselyn yleiskuva'
hidden: false
---

SQL-kyselyn yleiskuva on seuraava:

`SELECT` – `FROM` – `WHERE` – `GROUP BY` – `HAVING` – `ORDER BY`

Kyselystä riippuu, mitkä näistä osista siinä esiintyvät.
Tämä on kuitenkin aina järjestys,
jossa kyselyn osat sijaitsevat toisiinsa nähden.

Seuraavassa on esimerkki kyselystä, joka sisältää yhtä aikaa kaikki nämä osat.

## Esimerkki

Tarkastellaan taulua `Tehtavat`, jossa on projekteihin liittyviä tehtäviä.
Jokaisella tehtävällä on tietty tärkeysaste.

```x
id          projekti_id  tarkeys   
----------  -----------  ----------
1           1            3         
2           1            4         
3           1            4         
4           2            1         
5           2            5         
6           3            2         
7           3            4         
8           3            5   
```

Seuraava kysely etsii projektit, joissa on vähintään kaksi tehtävää,
joiden tärkeysaste on ainakin 3.

```sql
SELECT projekti_id, COUNT(*)
FROM Tehtavat
WHERE tarkeys >= 3
GROUP BY projekti_id
HAVING COUNT(*) >= 2
ORDER BY MAX(tarkeys) DESC;
```

Kyselyn tulos on tässä:

```x
projekti_id  COUNT(*)  
-----------  ----------
3            2         
1            3         
```

## Miten kysely toimii?

Kyselyn lähtökohtana ovat kaikki taulussa `Tehtavat` olevat rivit.
Ehto `WHERE tarkeys >= 3` valitsee käsittelyyn seuraavat rivit:

```x
id          projekti_id  tarkeys   
----------  -----------  ----------
1           1            3         
2           1            4         
3           1            4         
5           2            5         
7           3            4         
8           3            5   
```

Kyselyssä on käytössä ryhmittely `GROUP BY projekti_id`,
joka jakaa rivit ryhmiin näin:

```x
id          projekti_id  tarkeys   
----------  -----------  ----------
1           1            3         
2           1            4         
3           1            4         
```

```x
id          projekti_id  tarkeys   
----------  -----------  ----------
5           2            5         
```

```x
id          projekti_id  tarkeys   
----------  -----------  ----------
7           3            4         
8           3            5   
```

Koska kyselyssä on osa `HAVING COUNT(*) >= 2`,
ryhmistä valitaan ne, joissa on ainakin kaksi riviä:

```x
id          projekti_id  tarkeys   
----------  -----------  ----------
1           1            3         
2           1            4         
3           1            4         
```

```x
id          projekti_id  tarkeys   
----------  -----------  ----------
7           3            4         
8           3            5   
```

Tulostauluun valitaan joka ryhmästä sarake `projekti_id`
sekä funktion `COUNT(*)` arvo:

```x
projekti_id  COUNT(*)  
-----------  ----------
1            3       
3            2         
```

Järjestystapa on `ORDER BY MAX(tarkeys) DESC`,
joten rivit järjestetään suurimmasti pienimpään
ryhmän suurimman tärkeysasteen mukaan:

```x
projekti_id  COUNT(*)  
-----------  ----------
3            2         
1            3       
```
